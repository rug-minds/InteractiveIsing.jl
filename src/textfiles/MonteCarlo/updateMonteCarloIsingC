# function updateMonteCarloIsingC!()
#     T = TIs[]
#     @inline function deltE(efac,newstate,oldstate)
#         return efac*(newstate-oldstate)
#     end

#     @inline function sampleCState()
#         Float32(2*(rand()-.5))
#     end

#     beta = T>0 ? 1/T : Inf

#     idx = rand(ising_it(g))
     
#     oldstate = g.state[idx]

#     efactor = getEFactor(g,idx, htype)

#     newstate = sampleCState()
    
#     Ediff = deltE(efactor,newstate,oldstate)
#     if (Ediff < 0 || rand() < exp(-beta*Ediff))
#         @inbounds g.state[idx] = newstate 
#     end
# end
function updateMonteCarloIsingC()
    @inline function deltE(efac,newstate,oldstate)
        return efac*(newstate-oldstate)
    end
    
    @inline function sampleCState()::Float32
        Float32(2.) *(rand(rng,Float32)- Float32(.5))
    end

    beta = 1/(TIs[])

    idx = rand(rng, g_iterator)
     
    oldstate = @inbounds g.state[idx]

    efactor = getE(g,idx)

    randnum = rand(rng,Float32)

    newstate = Float32(2.) * randnum - Float32(.5)
    
    Ediff = deltE(efactor,newstate,oldstate)
    if (Ediff < 0 || randnum < exp(-beta*Ediff))
        @inbounds g.state[idx] = newstate 
    end
end